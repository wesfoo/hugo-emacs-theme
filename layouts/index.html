{{ define "main" }}
{{- /* Single Buffer View - Shows one buffer at a time like Emacs */ -}}

{{- /* Buffer: *posts* (Dired-style article list) */ -}}
<section class="buffer buffer-list active" 
         id="buffer-list" 
         role="region" 
         aria-label="Article list"
         tabindex="0">
  <div class="buffer-body">
    <ul class="article-list" id="article-list" role="listbox" aria-label="Articles">
      {{- $posts := where .Site.RegularPages "Section" "post" -}}
      {{- range $index, $post := $posts.ByDate.Reverse -}}
      <li class="article-item{{ if eq $index 0 }} selected{{ end }}" 
          role="option"
          aria-selected="{{ if eq $index 0 }}true{{ else }}false{{ end }}"
          data-index="{{ $index }}"
          data-url="{{ $post.RelPermalink }}"
          data-title="{{ $post.Title }}"
          data-date="{{ $post.Date.Format "2006-01-02" }}"
          data-reading-time="{{ $post.ReadingTime }}"
          data-word-count="{{ $post.WordCount }}">
        <span class="article-marker" aria-hidden="true">{{ if eq $index 0 }}>{{ else }} {{ end }}</span>
        <span class="article-meta">
          <span class="article-reading-time" title="Reading time">{{ $post.ReadingTime }}min</span>
          <span class="article-word-count" title="Word count">{{ $post.WordCount | lang.FormatNumber 0 }}</span>
          <span class="article-date">{{ $post.Date.Format "2006-01-02" }}</span>
        </span>
        <span class="article-title">{{ $post.Title }}</span>
        {{- with $post.Params.tags }}
        <span class="article-tags">
          {{- range first 2 . }}#{{ . }} {{ end -}}
        </span>
        {{- end }}
      </li>
      {{- end }}
    </ul>
  </div>
  
  {{ partial "modeline.html" (dict 
    "buffer" "*posts*" 
    "mode" "Dired"
    "readonly" true
    "keyhint" "<kbd>n</kbd>/<kbd>p</kbd> nav  <kbd>RET</kbd> open"
  ) }}
</section>

{{- /* Buffer: Article content (shown when article is opened) */ -}}
<section class="buffer buffer-content" 
         id="buffer-content" 
         role="region" 
         aria-label="Article content"
         tabindex="0">
  <div class="buffer-body" id="content-body">
    <article class="post-content" id="article-content">
    </article>
  </div>
  
  {{ partial "modeline.html" (dict 
    "buffer" "*article*" 
    "mode" "Org"
    "readonly" true
    "keyhint" "<kbd>n</kbd>/<kbd>p</kbd> articles  <kbd>q</kbd> back"
  ) }}
</section>

{{- /* Hidden container with all post content for JS to use */ -}}
<div id="posts-data" style="display:none;">
  {{- $posts := where .Site.RegularPages "Section" "post" -}}
  {{- range $index, $post := $posts.ByDate.Reverse -}}
  <template data-post-index="{{ $index }}" data-post-url="{{ $post.RelPermalink }}">
    <div class="post-header">
      <h1 class="post-title">{{ $post.Title }}</h1>
      <div class="post-meta">
        <span class="post-date">{{ $post.Date.Format "2006-01-02" }}</span>
        <span class="post-reading-time">{{ $post.ReadingTime }} min read ({{ $post.WordCount }} words)</span>
        {{- with $post.Params.tags }}
        <div class="post-tags">
          {{- range . }}
          <a href="{{ (urlize (printf "tags/%s/" .)) | absLangURL }}" class="post-tag">{{ . }}</a>
          {{- end }}
        </div>
        {{- end }}
      </div>
    </div>
    <div class="post-body">
      {{ $post.Content }}
    </div>
  </template>
  {{- end }}
</div>
{{ end }}
